# 索引是什么

索引（index）是一种帮助MySQL高效获取数据的数据结构。在数据之外，MySQL还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用数据，这样就可以在这些数据结构上实现高级查找算法。

**索引的特点**

| 优势                              | 劣势                   |
| ------------------------------- | -------------------- |
| 提高数据检索的效率，降低数据库的IO成本            | 索引列是要占用空间的           |
| 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗 | 降低表的增删改操作速度，因为需要维护索引 |

但优势比起劣势，可以说劣势可以忽略不计。

# 索引结构

MySQL的索引是在村粗引擎层实现的，不同的存储引擎有不同的索引结构。

| 索引结构          | 描述                                         |
| ------------- | ------------------------------------------ |
| B+tree索引      | 大部分引擎都支持B+树                                |
| Hash索引        | 底层数据结构是用哈希表实现的，只有精确匹配索引列的查询才有效，不支持范围查询     |
| R-tree空间索引    | 空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少 |
| Full-text全文索引 | 是一种通过建立倒排索引,快速匹配文档的方式。类似Lucene,Solr,ES     |

**支持情况**

| 索引结构      | InnoDB | MyISAM | Memory |
| --------- | ------ | ------ | ------ |
| B+tree    | 支持     | 支持     | 支持     |
| Hash      | 不支持    | 不支持    | 支持     |
| R-tree    | 不支持    | 支持     | 不支持    |
| Full-text | 支持     | 支持     | 不支持    |

**二叉树**

![二叉树](./images/二叉树.png)

- 当插入顺序为：22、15、30、10、20、26、35，对于这样的顺序会生成一个平衡的二叉树，这样的二叉树查找速度最好

- 当插入顺序为：35、30、26、22、20、15、10，这样的顺序会生成一个单链表，查找速度和全表扫描没什么区别，这也是MySQL没有选择二叉树作为索引。

**红黑树**

红黑树是一个自平衡的二叉树，能够解决因为顺序问题导致的不平衡的情况。

但随着数量的增加，红黑树的层级也会非常高，查找速度依然慢。

**B-Tree**

B-Tree是一种多叉路衡查找树，和二叉树相比，B树每个节点可以有多个分支，即多叉。

比如一颗最大度数为（max-degree）5阶的b-tree，B树每个节点最多存储4个数据，5个指针（指向子节点），

如果一个节点超过了4个数据，会将中间的元素向上提，并将原本的4个节点分裂成2个分支。

![B-Tree](./images/B-Tree.png)

B树每个节点存储着指针和数据，相比红黑树可以根据max-degree来控制数的高度。

**B+Tree**

B+Tree是B-Tree的变种，主要将数据全部存储到最底层的子节点中，上层只存储索引数据。

![B+Tree](./images/B+Tree.png)

**MySQL中的B+Tree**

MySQL中的B+Tree针对B+Tree做了优化，叶子节点从单向连边变成首尾相连的双向链表，提高区间访问的性能，利于排序。

![MySQL中的B+Tree](./images/MySQL中的B+Tree.png)

**Hash索引**

哈希索引是利用了哈希算法将值换算成hash值，并映射到对应的槽位上，然后存储在hash表中，但哈希算法会存在哈希冲突，MySQL在冲突值增加链表来解决。

![哈希索引](./images/哈希索引.png)

**为什么InnoDB选择B+Tree**

- 相对于二叉树，层级更少，搜索效率高。

- 对于B-Tree，无论叶子节点还是非叶子节点，都会保存数据，这样导致数据一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低。

- 相对hash索引，B+Tree支持范围匹配以及排序操作。

# 索引分类

在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引。

| 分类   | 含义                       | 特点           | 关键字      |
| ---- | ------------------------ | ------------ | -------- |
| 主键索引 | 针对表中主键创建的索引              | 默认自动创建，只能有一个 | PRIMARY  |
| 唯一索引 | 避免一列中数据值重复               | 可以有多个        | UNIQUE   |
| 常规索引 | 快速定位特定数据                 | 可以有多个        |          |
| 全文索引 | 全文索引查找文本中的关键词，而不是比较索引中的值 | 可以有多个        | FULLTEXT |

**聚集索引&二级索引**

按索引的存储形式，可以分为聚集索引和二级索引

| 分类   | 含义                           | 特点        |
| ---- | ---------------------------- | --------- |
| 聚集索引 | 将数据存储与索引放到一块，索引结果的叶子节点保存了行数据 | 必须有，且只有一个 |
| 二级索引 | 将数据与索引分开存储，索引结构的叶子节点存储是对应的主键 | 可以存在多个    |

比如说一张表，有id和name两个字段，为id创建主键索引，为name创建普通索引

- 对于主键索引就是聚集索引，最底层叶子节点中直接存储了数据，通过索引查找直接可以查到数据并返回。

- 而name的普通索引是一个二级索引，最底层叶子节点中存储的是id号，需要重新回到聚集索引中查找具体的行数据，效率更低，这种现象也叫回表查询。

**InnoDB主键索引的B+Tree高度有多高**


