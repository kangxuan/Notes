# Buffer

buffer是缓冲区，是一段连续的内存空间。

```js
// 通过alloc创建的buffer是相当于申请了 10 字节的内存空间，每个字节的值为 0
let buf = Buffer.alloc(10)
console.log(buf)

// 通过allocUnsafe创建的buffer 中可能存在旧的数据, 可能会影响执行结果，所以叫 unsafe
let buf_2 = Buffer.allocUnsafe(100)
console.log(buf_2)

// from
let buf_3 = Buffer.from('hello')
let buf_4 = Buffer.from([105, 108, 111, 118, 101, 121, 111, 117])
console.log(buf_3)
console.log(buf_4)
console.log(buf_4.toString())

// 修改
buf_4[0] = 361 // 舍弃高位的数字  0001 0110 1001  => 0110 1001
console.log(buf_4.toString())

//中文
let buf_5 = Buffer.from('你好');
console.log(buf_5.toString());
```

# fs模块

fs是file system的简写，也就是文件系统模块，是node内置的模块，用于对磁盘的操作。

### 1. 文件写入

**异步写入/同步写入**

```js
/**
 * 新建一个文件，将文本内容写入到文件
 */

// 导入fs摸摸
const fs = require('fs')

// 异步写入
fs.writeFile('./座右铭.txt', '三人行必有我师', err => {
    if (err) {
        console.log('写入失败')
        return
    }
    console.log('写入成功')
})

// 同步写入
fs.writeFileSync('./data.txt', '同步写入的内容')
```

**异步追加/同步追加**

```js
const fs = require('fs')

// 异步追加
fs.appendFile('./座右铭.txt', ',择其善者而从之, 择期不善者而改之', err => {
    if (err) {
        console.log('追加失败')
        return
    }
    console.log('追加成功')
})

// 同步追加
fs.appendFileSync('./data.txt', '，这是同步追加的内容')
```

**流式写入**

也就是开启一个文件，然后可以不断写入，可以减少文件打开次数，降低磁盘OI开销，用于大批量内容写入。

```js
const fs = require('fs')

// 创建一个流式写入，返回Object
const w = fs.createWriteStream('./流式写入文件.txt')
w.write('第一句内容。')
w.write('第二句内容。')
w.write('第三句内容。')

// 关闭句柄
w.close()
```

### 2. 文件读取

**异步读取/同步读取**

```js
const fs = require('fs')

// 异步读取文件
fs.readFile('./座右铭.txt', (err, data) => {
    if (err) {
        console.log('读取失败')
        return
    }
    console.log(data.toString())
})

// 同步读取文件，直接返回data
const data = fs.readFileSync('./座右铭.txt')
console.log(data.toString())
```

**流式读取**

```js
const fs = require('fs')

const r = fs.createReadStream('./流式写入文件.txt')

// 每次取出 64k 数据后执行一次 data 回调
r.on('data', data => {
    console.log(data.toString())
    console.log(data.length)
})

// 监听读取完毕
r.on('end', () => {
    console.log('读取完毕')
})
```

**文件复制**

思路就是读取文件然后写入文件

```js
/**
 * 文件复制
 * 将A文件复制成一个A_copy文件
 */

const fs = require('fs')

// 复制函数
function copy(orignFile, targetFile) {
    // 创建流读取器
    const r = fs.createReadStream(orignFile)
    // 创建流写入器
    const w = fs.createWriteStream(targetFile)

    r.on('data', data => {
        console.log(data.toString())
        w.write(data)
    })

    r.on('end', () => {
        console.log('复制完毕')
    })
}

copy('./座右铭.txt', './座右铭_copy.txt')
```

### 3. 文件操作

**文件重命名**

```js
const fs = require('fs')

// 异步重命名文件
fs.rename('./座右铭_copy.txt', './座右铭_copy1.txt', err => {
    if (err) {
        console.log('重命名文件错误')
        return
    }
    console.log('重命名文件完成')
})

// 同步重命名文件
// fs.renameSync('./座右铭_copy1.txt', './座右铭_copy2.txt')
```

**文件移动**

和重命名用同一个方法

```js
const fs = require('fs')

// 异步移动文件，要保证移动的文件目录必须存在
fs.rename('./data.txt', './data/data.txt', (err) => {
    if (err) {
        console.log('移动文件出现错误')
        return
    }
    console.log('移动文件成功')
})

// 同步移动文件
// fs.renameSync('./data.txt', './data/data.txt')
```

**文件删除**

```js
const fs = require('fs')

// 异步删除文件
fs.unlink('./座右铭_copy1.txt', (err) => {
    if (err) {
        console.log('异步删除文件失败')
        return
    }
    console.log('异步删除文件成功')
})

// 同步删除文件
fs.unlinkSync('./data/data.txt')
```

### 4. 文件夹操作

**创建文件夹**

```js
const fs = require('fs')

// 异步创建文件夹
fs.mkdir('./dir1', err => {
    if (err) throw err
    console.log('异步创建文件夹成功')
})

// 异步递归创建文件夹
fs.mkdir('./dir2/dir3', {recursive: true}, err => {
    if (err) throw err
    console.log('异步递归创建文件夹成功')
})

// 同步递归创建文件夹
fs.mkdirSync('./dir3/dir4', {recursive: true})
```

**读取文件夹**

```js
const fs = require('fs')

// 异步读取文件夹
fs.readdir('../', (err, data) => {
    if (err) throw err
    console.log(data)
})

// 同步读取文件夹
const dir = fs.readdirSync('./')
console.log(dir)
```

**删除文件夹**

```js

```
