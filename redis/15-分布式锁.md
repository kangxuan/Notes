# 单机锁

单机锁是指在单个机器或进程内使用的锁机制，用于保护共享资源访问，它适用于单机环境中的并发控制和数据一致性需求。

**问题**

对于单机环境没什么问题，但是一旦遇到服务器扩容或分布式系统就无法保证互斥效果，因为单机锁只在单台机器上有效。

**go语言的单机锁**

```go
func main() {
	var lock sync.Mutex
	i := 0
	// 加锁
	lock.Lock()
	// 释放锁
	defer lock.Unlock()
	i++
	fmt.Println(i)
}
```

# 引入分布式锁

为了解决分布式系统中的互斥访问的问题，用于保护共享资源或临界区的访问，在多个进程或多台机器之间，确保只有一个进程能够获取到锁，并在完成后释放锁，以保证一致性和并发控制。实现分布式锁需要选择合适的存储介质，比如redis、zookeeper等。

**写好一个分布式锁的要求**

- 独占性
  
  - OnlyOne，任何时刻只能有且仅有一个线程持有

- 高可用
  
  - Redis集群下，不能因为某一个节点挂了而出现获取锁和释放锁失败
  
  - 高并发请求下，性能不能减弱

- 防死锁
  
  - 杜绝死锁，必须有超时控制机制或撤销操作，有兜底跳出方案

- 不乱抢
  
  - 不能unlock别人的锁，只能自己加锁自己解锁

- 重入性
  
  - 同一个节点的同一个线程如果获取锁后，它也要可以再次获取这个锁。

**手写分布式锁**


