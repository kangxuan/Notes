# 并发相关面试题

### 1. 相对线程，goroutine有哪些优势？

- 从调度上来看，goroutine的调度开销比线程小很多
  
  - 线程调度是系统层面的调度，会挂起当前正在执行的线程并将寄存器中的内容保存到内存中，并选出接下来要执行的线程并从内存中恢复该线程的寄存器信息，然后恢复执行该线程的信息，然后继续执行线程；从一个线程切换到另一个线程需要完整的上下文切换，因为可能需要多次内存访问，索引这个切换上下文的操作开销较大，会增加运行的cpu周期。
  - goroutine调度是`runtime`层面实现，通过M:N调度技术（M个goroutine、N个线程），因为完全是在用户态下完成的，不涉及到内核态与用户态之间的频繁切换，所以goroutine的调度成本要低得多

- 从栈空间上来看，goroutine的栈开销比线程更灵活
  
  - 线程一般都有固定的栈内存，通常是2M。
  
  - goroutine初始栈空间很小，一般是2K，所以go语言中一次创建数万个goroutine也是可能的，并且goroutine的栈不是固定的，可以根据需要动态增大缩小。
